Модуль реализует функционал формы обратной связи с ajax-отправкой. Он прекрасно подходит для быстрого разворачивания формы на странице. 

Будет полезен как для редакции Старт, так и для других редакций, когда есть необходимость вывести на странице простую форму, не прибегая к долгим предварительным настройкам и сборке формы в админке.

### Установка ###
Модуль устанавливается стандартным способ через админку битрикса. В процессе установки добавляется компонент **abcwww:custom.form**. 

Все дефолтные настройки вынесены в параметры компонента. Обработка формы в публичной части использует нативный js (нет необходимости подключать jquery), можно вызывать несколько компонентов на одной странице - в этом случае нужно обязательно указать уникальное название для каждой формы в настройках компонента.

### Настройка формы ###

Настройки компонента позволяют выбрать предустановленные поля формы из предложенного списка, отсортировать их и задать обязательные, есть возможность добавить дополнительные поля формы (код для атрибута name), название этих полей можно добавить тут же через разделитель == (пример: **COMPANY==Компания**). Для предустановленных полей зарезервированы имена полей: **CF_NAME**, **CF_PHONE**, **CF_EMAIL**, **CF_COMMENT**.

Можно добавить поле для загрузки файла и настроить проверку на тип и размер загружаемого файла. У поля файла в форме предустановлено имя **CF_FILE**.

В процессе обработки на сервере все поля формы экранируются, у предустановленных полей телефона и email идет отдельная валидация по формату, можно включить js-маску телефона, по умолчанию в настройках включена стилизация Bootstrap 5 и антиспам, проверяющий у пользователя наличие работающего js и совпадение сессий. 

###  Отправка Email ###

Есть настройка включения отправки письма, при установке модуля автоматически создается почтовое событие **ABCWWW_CUSTOM_FORM_FILLING** с прикрепленным почтовым шаблоном, но можно указать своё почтовое событие. В настройках компонента есть поле получателя, в нём указывается email, который подхватывается почтовым шаблоном по макросу **#EMAIL_TO#** (в предустановленном шаблоне макрос **#EMAIL_TO#** выставлен по умолчанию).

### Сохранение данных формы ### 

Данные отправленной формы можно сохранить в инфоблок (выбирается в настройках), список отправленных полей сохраняется в поле "описание анонса", для сохранения отправленного файла в инфоблоке необходимо добавить свойство типа файл и указать его символьный код в настройке "Код свойства инфоблока для сохранения файла".

### Кастомизация шаблона ###

При кастомизации шаблона компонента под свою верстку **ВАЖНО** оставить служебные классы разметки с префиксом js - они отвечают за дефолтный js-функционал. Основной класс формы - **jsCustomForm**, все остальные должны быть внутри него: 
* **jsCustomResult** - контейнер результатов успешной отправки 
* **jsCFTel** - подключается, если в настройках выбрана маска для поля телефона 

Скрытое поле формы **CF_ACTION** и вызов **bitrix_sessid_post()** не нужно удалять, это нарушит работу отправки формы.

К именам полей в форме добавляется префикс **CF_** (в настройках компонента у дополнительных полей формы префикс указывать не нужно), блоки оповещений валидации полей должны иметь класс  **CF_<имя поля>_error** . По умолчанию поле комментария можно выбрать в настройках списка предустановленных полей, но в шаблоне оно выводится последним - для этого в $arResult существует ключ массива 'EXCLUDE', при помощи которого можно отменить поле комментария в общем списке и вывести отдельно.


### js-событие ###

Для кастомизации оповещения при отправке формы js инициирует событие  **cf_success**, в которое передаются параметры message, success, erros и form. Пример js-кода обращения к событию:

```
document.addEventListener("cf_complete", function(event) {
    //console.log(event.detail)
    form = event.detail.form
    if (event.detail.success === true && form.getAttribute('id') === 'customFormId') {
        // выполняем действие в случае успешной отправки формы и если id формы customFormId
    }
})
```
Пример закомментированного кода для работы с событием **cf_success** есть в файле script.js в папке шаблона компонента.

### Замечания ###

Если на странице более одной формы, то нет возможности в настройках отключить Bootstrap только для одной формы. В этом случае у нужной формы необходимо убрать bootstrap-классы в шаблоне.